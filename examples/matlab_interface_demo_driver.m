% Matlab interface driver for QIST
% Author: David Cunningham
% Date: 28 May 2024
% currently must be run from folder /home/david/wrk/nstgro/qist

clear all;
clc;
cd libqist/fort/src/;
loadlibrary("mqist.a","mqist.h");
cd ../../..;
state_i = [10., 10., 10., 0., 0., 0., 0., 0.]';
state_o = NaN(8,1);
stm_o = NaN(8);
charnml = convertStringsToChars("/home/david/wrk/nstgro/qist/perturbed_test_qist_config.nml");
calllib('mqist','m_init_n', charnml);
[~,state_o] = calllib('mqist','m_state', 0.1, state_o)
[~,stm_o] = calllib('mqist','m_stm', 0.1, stm_o)
%[[  0.755368981729312	     0.220694986055124	    -0.119050040460373	    -3407.35358030614	-29.6812344912856   394.634332054075  2.12263391576505e-07  0.00388572422543580; ]
% [ -0.986354885641033	    -7.38009812103687	     2.71001061320353	     10057.6312956533	-28263.6749849764  -27633.7759793214  1.15030156737641e-06 -0.492393613199605; ]
% [ -0.119050969202040	    -0.606433073251123	     1.03914768509708	     394.699853681277	 81.3503809997542  -4348.03828077482 -2.78388113415554e-07 -0.0106768602084819; ]
% [  0.000244557027917484	 0.000670706079514130	-0.000189328027706933	-0.243523583760962	 2.40931371755689	2.31573448927564 -4.50873634141280e-11  4.43084838610481e-05; ]
% [  8.56399558022671e-05	 0.00120556215274743	-0.000235234392320524	-1.43229845401597	 5.12047298182991	3.93532408686251 -2.59514581333798e-10  7.88088456164751e-05; ]
% [ -0.000189332596836225	-0.00184280679062888	 0.000695837573164328	 2.31575000264780	-6.61974498655477  -5.76329148213970  1.92061737350810e-10 -0.000121739987931342; ]
% [  0 	                 0	                     0	                     0	                 0	                  0	                 1	                     1; ]
% [  0 	                 0	                     0	                     0	                 0	                  0	                 0	                     1 ]]
[~,~,~,~,state_o] = calllib('mqist','m_prop_once', 0.1, 0.2, state_i, 2, state_o)
% [ -8.570481787198638;
%   12.386934596724490;
%   19.371615005804740;
%    0.008761873638620;
%   -0.016468928507697;
%   -0.001326374946812;
%    0;
%    0
% ]

 
